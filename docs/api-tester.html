<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oriva API Tester</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .api-key-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .button-section {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .clear-btn {
            background: #6c757d;
        }
        .clear-btn:hover {
            background: #545b62;
        }
        input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin-top: 10px;
        }
        .results {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .result-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        .result-item.error {
            background: #fff5f5;
            border-color: #dc3545;
        }
        .result-item.success {
            background: #f8fff8;
            border-color: #28a745;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .endpoint {
            font-weight: bold;
            color: #333;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-success {
            background: #28a745;
            color: white;
        }
        .status-error {
            background: #dc3545;
            color: white;
        }
        .status-pending {
            background: #ffc107;
            color: #333;
        }
        .error-message {
            color: #dc3545;
            margin-bottom: 10px;
        }
        .response-data {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .info-box h3 {
            margin-top: 0;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🚀 Oriva API Tester</h1>
        <p>Test Oriva Platform APIs with your API key</p>
    </div>

    <div class="info-box">
        <h3>📖 How to Use</h3>
        <p><strong>This API tester requires a local server setup to securely handle your API key.</strong></p>
        
        <h4>Option 1: Simple Local Server (Recommended)</h4>
        <ol>
            <li><strong>Set up your environment:</strong>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin: 10px 0;">
# Create a .env file in your project root
echo "ORIVA_API_KEY=your_api_key_here" > .env</pre>
            </li>
            <li><strong>Create a simple server:</strong>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin: 10px 0;">
# Install a simple HTTP server
npm install -g http-server

# Or use Python
python -m http.server 8000</pre>
            </li>
            <li><strong>Create a proxy script</strong> (see setup instructions below)</li>
            <li><strong>Open this file</strong> in your browser via the local server</li>
        </ol>

        <h4>Option 2: Browser Developer Tools</h4>
        <ol>
            <li><strong>Open browser developer tools</strong> (F12)</li>
            <li><strong>Go to Console tab</strong></li>
            <li><strong>Set your API key:</strong>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin: 10px 0;">
window.ORIVA_API_KEY = 'your_api_key_here';</pre>
            </li>
            <li><strong>Click "Test All Endpoints"</strong> to test APIs</li>
        </ol>

        <p><strong>Security Note:</strong> Never commit API keys to version control. Use environment variables and server-side authentication for production.</p>
    </div>

    <div class="info-box">
        <h3>🔧 Setup Instructions for Local Server</h3>
        <p>To use the proxy approach, create a simple server that handles authentication:</p>
        
        <h4>Node.js Express Server</h4>
        <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0; overflow-x: auto;">
// server.js
const express = require('express');
const fetch = require('node-fetch');
require('dotenv').config();

const app = express();
app.use(express.static('docs'));

app.get('/api/test/*', async (req, res) => {
  const endpoint = req.params[0];
  const apiKey = process.env.ORIVA_API_KEY;
  
  if (!apiKey) {
    return res.status(500).json({ error: 'API key not configured' });
  }
  
  try {
    const response = await fetch(`https://oriva-9oe23kukl-orivas-projects.vercel.app/api/v1/${endpoint}`, {
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      }
    });
    
    const data = await response.json();
    res.status(response.status).json(data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000, () => {
  console.log('API Tester server running on http://localhost:3000');
});</pre>

        <h4>Python Flask Server</h4>
        <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin: 10px 0; overflow-x: auto;">
# server.py
from flask import Flask, jsonify, request
import requests
import os
from dotenv import load_dotenv

load_dotenv()
app = Flask(__name__, static_folder='docs')

@app.route('/api/test/<path:endpoint>')
def proxy_api(endpoint):
    api_key = os.getenv('ORIVA_API_KEY')
    
    if not api_key:
        return jsonify({'error': 'API key not configured'}), 500
    
    try:
        response = requests.get(
            f'https://oriva-9oe23kukl-orivas-projects.vercel.app/api/v1/{endpoint}',
            headers={
                'Authorization': f'Bearer {api_key}',
                'Content-Type': 'application/json'
            }
        )
        return jsonify(response.json()), response.status_code
    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(port=3000, debug=True)</pre>
    </div>

    <div class="button-section">
        <button id="test-btn" onclick="testAllEndpoints()">Test All Endpoints</button>
        <button class="clear-btn" onclick="clearResults()">Clear Results</button>
    </div>

    <div class="results">
        <h2>API Test Results</h2>
        <div id="results-container">
            <p class="loading">Click "Test All Endpoints" to start testing the Oriva APIs</p>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://oriva-9oe23kukl-orivas-projects.vercel.app/api/v1';
        
        const endpoints = [
            { path: 'health', name: 'Health Check', description: 'Check API health status' },
            { path: 'user/profile', name: 'User Profile', description: 'Get current user profile' },
            { path: 'repositories', name: 'Repositories', description: 'List user repositories' },
            { path: 'teams', name: 'Teams', description: 'List user teams' },
            { path: 'notifications', name: 'Notifications', description: 'List user notifications' }
        ];

        async function testEndpoint(endpoint) {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result-item';
            resultDiv.innerHTML = `
                <div class="result-header">
                    <span class="endpoint">GET /api/v1/${endpoint.path}</span>
                    <span class="status-badge status-pending">Testing...</span>
                </div>
                <div style="color: #666; font-size: 14px; margin-bottom: 10px;">${endpoint.description}</div>
            `;
            
            document.getElementById('results-container').appendChild(resultDiv);

            try {
                let response;
                
                // Try proxy endpoint first (for local server setup)
                try {
                    response = await fetch(`/api/test/${endpoint.path}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                } catch (proxyError) {
                    // Fallback to direct API call with browser-set API key
                    const apiKey = window.ORIVA_API_KEY;
                    if (!apiKey) {
                        throw new Error('No API key found. Please set window.ORIVA_API_KEY in browser console or use a local server with proxy.');
                    }
                    
                    response = await fetch(`${API_BASE_URL}/${endpoint.path}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        mode: 'cors'
                    });
                }

                const data = await response.json();
                const isSuccess = response.ok;

                resultDiv.className = `result-item ${isSuccess ? 'success' : 'error'}`;
                resultDiv.innerHTML = `
                    <div class="result-header">
                        <span class="endpoint">GET /api/v1/${endpoint.path}</span>
                        <span class="status-badge ${isSuccess ? 'status-success' : 'status-error'}">
                            ${response.status}
                        </span>
                    </div>
                    <div style="color: #666; font-size: 14px; margin-bottom: 10px;">${endpoint.description}</div>
                    ${!isSuccess ? `<div class="error-message"><strong>Error:</strong> ${data.message || 'Request failed'}</div>` : ''}
                    <details>
                        <summary style="cursor: pointer; font-weight: bold;">Response Data</summary>
                        <div class="response-data">${JSON.stringify(data, null, 2)}</div>
                    </details>
                `;

            } catch (error) {
                resultDiv.className = 'result-item error';
                resultDiv.innerHTML = `
                    <div class="result-header">
                        <span class="endpoint">GET /api/v1/${endpoint.path}</span>
                        <span class="status-badge status-error">Error</span>
                    </div>
                    <div style="color: #666; font-size: 14px; margin-bottom: 10px;">${endpoint.description}</div>
                    <div class="error-message"><strong>Error:</strong> ${error.message}</div>
                    <div class="error-message"><strong>Setup Required:</strong> See the instructions above to set up your API key securely.</div>
                `;
            }
        }

        async function testAllEndpoints() {
            const testBtn = document.getElementById('test-btn');
            const resultsContainer = document.getElementById('results-container');
            
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            resultsContainer.innerHTML = '<p class="loading">Testing endpoints...</p>';

            for (const endpoint of endpoints) {
                await testEndpoint(endpoint);
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            testBtn.disabled = false;
            testBtn.textContent = 'Test All Endpoints';
        }

        function clearResults() {
            document.getElementById('results-container').innerHTML = 
                '<p class="loading">Click "Test All Endpoints" to start testing the Oriva APIs</p>';
        }

        // Check if API key is available on page load
        window.onload = function() {
            if (window.ORIVA_API_KEY) {
                console.log('✅ API key found in browser environment');
            } else {
                console.log('⚠️ No API key found. Use browser console to set window.ORIVA_API_KEY or set up a local server with proxy.');
            }
        };
    </script>
</body>
</html>
